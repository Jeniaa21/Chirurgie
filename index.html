<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chirurgie Complexe ‚Äî GTA RP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script> tailwind.config = { darkMode: 'class' };</script>
  <style>
    :root { --bg:#f8fafc; --panel:#ffffff; --border:#e2e8f0; --text:#0f172a; --muted:#64748b; --chip:#f1f5f9; --shadow:0 8px 24px rgba(2,6,23,.06); --ring:rgba(15,23,42,.12); --accent:#0f172a; }
    .dark { --bg:#0b1220; --panel:#0f172a; --border:#1f2937; --text:#e5e7eb; --muted:#94a3b8; --chip:#111827; --shadow:0 8px 24px rgba(0,0,0,.35); --ring:rgba(148,163,184,.2); --accent:#38bdf8; }
    body { background:var(--bg); color:var(--text); }
    .card{ background:var(--panel); border:1px solid var(--border); border-radius:1rem; box-shadow:var(--shadow); }
    .btn{ display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .75rem; border-radius:.75rem; border:1px solid var(--border); font-weight:600; font-size:.9rem; }
    .btn:hover{ box-shadow:0 0 0 6px var(--ring); }
    .btn-primary{ background:var(--accent); color:white; border-color:var(--accent); }
    .btn-ghost{ background:var(--panel); color:var(--text); }
    .badge{ display:inline-flex; align-items:center; padding:.15rem .5rem; border-radius:9999px; font-size:.75rem; border:1px solid var(--border); background:var(--chip); color:var(--muted); }
    .tabs button{ padding:.4rem .75rem; border-radius:.6rem; font-weight:600; font-size:.9rem; color:var(--muted); }
    .tabs button.active{ background:var(--accent); color:white; }
    .list-dash li{ position:relative; padding-left:1rem; }
    .list-dash li::before{ content:"‚Ä¢"; position:absolute; left:0; color:var(--accent); }
    .sticky-col{ position:sticky; top:6rem; }
    .field{ border:1px solid var(--border); background:var(--panel); color:var(--text); border-radius:.75rem; padding:.6rem .75rem; }
    .hint{ color:var(--muted); }
  </style>
</head>
<body>
  <header class="sticky top-0 z-30 backdrop-blur border-b" style="background:color-mix(in oklab,var(--panel) 80%, transparent)">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="flex items-center gap-2">
        <span class="text-2xl">ü©∫</span>
        <h1 class="text-lg md:text-xl font-semibold">Chirurgie Complexe ‚Äî Guide RP</h1>
      </div>
      <span class="ml-auto badge">H√¥pital ‚Äî GTA RP</span>
      <button id="themeToggle" class="btn btn-ghost ml-2" title="Mode sombre (t)">üåó <span class="hidden md:inline">Th√®me</span></button>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 grid lg:grid-cols-3 gap-6">
    <section class="lg:col-span-2 space-y-4">
      <div class="card p-4">
        <div class="flex flex-col gap-4">
          <div class="flex flex-wrap gap-2 items-center">
            <div class="relative grow">
              <input id="q" class="field pl-10 w-full" placeholder="Rechercher une cat√©gorie ou une op√©ration‚Ä¶" />
              <span class="absolute left-3 top-1/2 -translate-y-1/2 opacity-60">üîé</span>
            </div>
            <button id="btnReset" class="btn btn-ghost">‚Ü∫ R√©initialiser</button>
          </div>
          <div id="results" class="grid md:grid-cols-2 gap-3"></div>
          <div id="detailsWrap"></div>
        </div>
      </div>
    </section>

    <aside class="space-y-4">
      <div class="card p-4 sticky-col">
        <div class="flex items-center gap-2 mb-2">
          <span>üìù</span>
          <h2 class="text-base font-semibold">Rapport m√©dical (g√©n√©rateur)</h2>
        </div>
        <textarea id="report" class="w-full min-h-[380px] field font-mono" placeholder="Clique sur 'Composer' puis choisis le type d'intervention‚Ä¶"></textarea>
        <div class="flex gap-2 justify-end mt-2">
          <button id="btnCopy" class="btn btn-ghost">üìã Copier</button>
          <button id="btnDownload" class="btn btn-primary">‚¨áÔ∏è T√©l√©charger</button>
        </div>
        <hr class="my-3" style="border-color:var(--border)" />
        <p class="text-sm hint">
          Le rapport contient uniquement : <b>BLOC/OP√âRATION</b> et <b>POST-OP / SURVEILLANCE</b>.
          S√©lectionne un <b>type d'intervention</b> pour un rapport cibl√©.
        </p>
      </div>
    </aside>
  </main>

  <footer class="max-w-7xl mx-auto px-4 pb-8 text-xs hint">
    <hr class="mb-3" style="border-color:var(--border)" />
    ‚ö†Ô∏è Outil de jeu ‚Äî GTA RP. Proc√©dures simplifi√©es. Ce contenu ne constitue pas un conseil m√©dical r√©el.
  </footer>

  <script>
  // Th√®me
  const root=document.documentElement, THEME_KEY='gta_rp_theme';
  function setTheme(m){ if(m==='dark'){ root.classList.add('dark'); localStorage.setItem(THEME_KEY,'dark'); } else { root.classList.remove('dark'); localStorage.setItem(THEME_KEY,'light'); } }
  (function(){ const saved=localStorage.getItem(THEME_KEY); if(saved) setTheme(saved); else if(matchMedia('(prefers-color-scheme: dark)').matches) setTheme('dark'); })();
  document.getElementById('themeToggle').onclick=()=>setTheme(root.classList.contains('dark')?'light':'dark');
  addEventListener('keydown',e=>{ if(e.key.toLowerCase()==='t') document.getElementById('themeToggle').click(); });

  // -----------------------
  // Donn√©es (toutes cat√©gories + proc√©dures)
  // ui = libell√© simple (affich√©), label = terme technique (dans le rapport)
  // -----------------------
  const bank = [
    // VISC√âRAL / ABDOMEN
    {
      id:'visc', categorie:'Visc√©ral/Abdomen', titre:'Visc√©ral/Abdomen (appendice, v√©sicule, hernie, r√©section‚Ä¶)',
      bloc:["Appendicectomie (souvent coelio)","Chol√©cystectomie coelio","Herniorraphie/mesh","R√©section intestinale ¬± stomie","Gastrectomie / sleeve","H√©patectomie partielle","Pancr√©atectomie","Spl√©nectomie"],
      postop:["Surveillance souillures/saignement","Reprise du transit","Douleur"],
      procedures:[
        {id:'appendicectomie', label:'Appendicectomie', ui:"Retrait de l'appendice (Appendicectomie)", bloc:["Voie coelioscopique","Ligature/section appendice","Lavage si p√©ritonite"], postop:["Douleur","Transit","Fi√®vre"]},
        {id:'cholecystectomie', label:'Chol√©cystectomie', ui:"Ablation de la v√©sicule biliaire (Chol√©cystectomie)", bloc:["Dissection triangle de Calot","Clipage canal/art√®re cystique","Extraction v√©sicule"], postop:["Douleur/ict√®re","Alimentation progressive"]},
        {id:'hernie', label:'Hernioplastie', ui:"R√©paration d'une hernie (Hernioplastie)", bloc:["R√©int√©gration sac","Fermeture orifice","Pose proth√®se (mesh)"], postop:["Douleur locale","H√©matome","Repos"]},
        {id:'resection', label:'R√©section intestinale', ui:"Retrait d'un segment d'intestin (R√©section intestinale)", bloc:["R√©section segmentaire","Anastomose","Stomie si besoin"], postop:["Transit","Drains","Fi√®vre"]},
        {id:'gastrectomie', label:'Gastrectomie', ui:"Retrait partiel/total de l'estomac (Gastrectomie)", bloc:["Partielle/totale","Curage ganglionnaire","Reconstruction Roux-en-Y"], postop:["SNG","Fistule","Alimentation","Vit. B12"]},
        {id:'hepatectomie', label:'H√©patectomie', ui:"Retrait partiel du foie (H√©patectomie)", bloc:["R√©section segmentaire/lobectomie","Clampage p√©diculaire","H√©mostase"], postop:["Bilan h√©patique","Drains","Saignement"]},
        {id:'pancreatectomie', label:'Pancr√©atectomie', ui:"Retrait partiel du pancr√©as (Pancr√©atectomie)", bloc:["Whipple ou distale","Anastomoses","H√©mostase"], postop:["Fistule pancr√©atique","Glyc√©mie","Douleur"]},
        {id:'splenectomie', label:'Spl√©nectomie', ui:"Retrait de la rate (Spl√©nectomie)", bloc:["Ligature p√©dicule","Extraction rate"], postop:["Saignement","Vaccinations","Douleur"]}
      ]
    },

    // THORAX
    {
      id:'thorax', categorie:'Thorax', titre:'Chirurgie thoracique (lobe, m√©diastin, trach√©e, trauma)',
      bloc:["Lobectomie/segmentectomie","D√©cortication pleurale","Trach√©otomie"],
      postop:["Surveillance respi + drains","Kin√© respi","Fuites d'air"],
      procedures:[
        {id:'lobectomie', label:'Lobectomie', ui:"Retrait d‚Äôun lobe pulmonaire (Lobectomie)", bloc:["VATS/Thoracotomie","Section art√®re/veine/bronche du lobe","Contr√¥le h√©mostase"], postop:["SpO2, douleur","D√©bit/bullage drains","Kin√©"]},
        {id:'pneumonectomie', label:'Pneumonectomie', ui:"Retrait d‚Äôun poumon (Pneumonectomie)", bloc:["Ligature vaisseaux pulmonaires","Section bronche principale","Fermeture moignon"], postop:["D√©viation m√©diastin","Balance hydrique stricte","Douleur"]},
        {id:'decortication', label:'D√©cortication pleurale', ui:"Retrait de la coque fibreuse (D√©cortication)", bloc:["Ouverture thorax","Ablation coque fibreuse","R√©-expansion pulmonaire"], postop:["D√©bit drain","Fi√®vre/infection","SpO2"]},
        {id:'tracheotomie', label:'Trach√©otomie', ui:"Ouverture de la trach√©e (Trach√©otomie)", bloc:["Incision trach√©ale","Mise en place canule","Fixation"], postop:["Soins canule","Aspirations","Saignement"]},
        {id:'oesophagectomie', label:"≈ísophagectomie", ui:"Retrait de l'≈ìsophage (≈ísophagectomie)", bloc:["Voies abdomino-thoraciques","R√©section ≈ìsophage","Ascension estomac + anastomose"], postop:["Fistule anastomotique","Nutrition ent√©rale","Surveillance drains"]}
      ]
    },

    // ORTHOP√âDIE / OS
    {
      id:'os-fix', categorie:'Orthop√©die/Os', titre:'R√©paration osseuse (broches/vis/plaques/p√¢te)',
      bloc:["Broches/clous IM","Plaques + vis","P√¢te/greffe osseuse"],
      postop:["Contr√¥le vasculo-nerveux","Imagerie","D√©charge/b√©quilles"],
      procedures:[
        {id:'broches', label:'Broches / clous intram√©dullaires', ui:"Stabilisation par clou/broches (Clou IM)", bloc:["Entr√©e canal m√©dullaire","R√©duction fracture","Verrouillage prox/dist"], postop:["V/N distal","Radio de contr√¥le","Appui selon indication"]},
        {id:'vis', label:'Ost√©osynth√®se par vis', ui:"Fixation par vis (Ost√©osynth√®se)", bloc:["Forage/mesure","Pose vis perpendiculaire","Contr√¥le stabilit√©"], postop:["Douleur/≈ìd√®me","Radio","Protection segment"]},
        {id:'plaques', label:'Plaques viss√©es', ui:"Plaque viss√©e (Ost√©osynth√®se)", bloc:["Exposition fracture","Plaque anatomique + vis verrouill√©es","Contr√¥le alignement"], postop:["Radio","Mobilisation encadr√©e","Surveillance cicatrice"]},
        {id:'pate', label:'Comblement osseux (p√¢te/greffe)', ui:"Comblement osseux (Greffe/p√¢te)", bloc:["Pr√©paration site","Comblement d√©faut","Stabilisation associ√©e"], postop:["Consolidation radiologique","Appui progressif","Douleur"]}
      ]
    },

    // CR√ÇNE / NEUROCHIR
    {
      id:'crane', categorie:'Cr√¢ne/Neurochir', titre:'Chirurgie cr√¢nienne (craniotomie / cr√¢nioplastie)',
      bloc:["Craniotomie","Plaques/vis titane","Cr√¢nioplastie/ciment"],
      postop:["Surveillance neuro","Scan de contr√¥le","Pr√©vention infection"],
      procedures:[
        {id:'craniotomie', label:'Craniotomie', ui:"Ouverture du cr√¢ne (Craniotomie)", bloc:["Volet osseux","√âvacuation l√©sion/h√©matome","Refixation (plaques/vis)"], postop:["GCS/pupilles","TDM de contr√¥le","Antibioprophylaxie (RP)"]},
        {id:'cranioplastie', label:'Cr√¢nioplastie', ui:"Reconstruction du cr√¢ne (Cr√¢nioplastie)", bloc:["Pr√©paration d√©faut","Implant autogreffe/titane/PMMA","Fixation"], postop:["Infection/collection","Relief/esth√©tique","Scan si besoin"]}
      ]
    },

    // RACHIS
    {
      id:'rachis', categorie:'Rachis', titre:'Rachis (discectomie, laminectomie, fusion, foraminotomie)',
      bloc:["Discectomie","Laminectomie","Fusion"],
      postop:["Surveillance neuro","Mobilisation","Contr√¥le imagerie"],
      procedures:[
        {id:'discectomie', label:'Discectomie', ui:"Retrait du disque ab√Æm√© (Discectomie)", bloc:["Voie post√©rieure/ant√©rieure","Ablation fragment discal","D√©compression racine"], postop:["Douleur radiculaire","Mobilisation prudente","Soin cicatrice"]},
        {id:'laminectomie', label:'Laminectomie', ui:"Ouverture du canal vert√©bral (Laminectomie)", bloc:["R√©section lame vert√©brale","D√©compression canal","H√©mostase"], postop:["D√©ficit moteur/sensoriel","Douleur","Mobilisation"]},
        {id:'fusion', label:'Fusion vert√©brale', ui:"Soudure de vert√®bres (Fusion)", bloc:["Pr√©paration intersomatique","Greffon/cage","Vis/tiges"], postop:["Corset si indiqu√©","Restrictions mouvements","Consolidation radiologique"]},
        {id:'foraminotomie', label:'Foraminotomie', ui:"√âlargissement du passage nerveux (Foraminotomie)", bloc:["Agrandissement foramen","Ablation ost√©ophytes","Lib√©ration racine"], postop:["Douleur/paresth√©sies","Mobilisation","Soin cicatrice"]}
      ]
    },

    // MUSCLES / TENDONS
    {
      id:'muscle', categorie:'Muscles/Tendons', titre:'Rupture musculaire (partielle/compl√®te)',
      bloc:["Suture des berges","Renfort tendineux"],
      postop:["Immobilisation","Mobilisation douce","Renforcement"],
      procedures:[
        {id:'suture-muscle', label:'Suture musculaire', ui:"Recoudre le muscle (Suture musculaire)", bloc:["Rep√©rage berges","Suture solide","H√©mostase"], postop:["Immobilisation courte","Mobilisation douce","Kin√©sith√©rapie"]},
        {id:'renfort-tendon', label:'Renfort tendineux', ui:"Renfort du tendon (Greffe/Ancrage)", bloc:["Greffe/renfort si besoin","Ancrages osseux/tendineux","Protection"], postop:["Attelle","R√©√©ducation progressive","Contr√¥le douleur"]}
      ]
    },

    // CARDIAQUE
    {
      id:'cardiaque', categorie:'Cardiaque', titre:'Cardiaque (pontage, valves, FA, DAV)',
      bloc:["Pontage","Valve","Ablation/MAZE","DAV"],
      postop:["REA/USIC","Infection","R√©√©ducation"],
      procedures:[
        {id:'pontage', label:'Pontage coronarien', ui:"D√©rivation des art√®res du c≈ìur (Pontage)", bloc:["Sternotomie","Greffe mammaire/saph√®ne","Ponts sur st√©noses"], postop:["Douleur sternale","Drainages","Reprise marche"]},
        {id:'valve', label:'Remplacement/R√©paration valvulaire', ui:"R√©paration/remplacement d‚Äôune valve (Valve)", bloc:["Exposition valve","R√©paration ou proth√®se","Test √©tanch√©it√©"], postop:["Anticoagulation (RP)","√âcho de contr√¥le","Infection"]},
        {id:'maze', label:'Maze/Ablation FA', ui:"Cicatrices anti-arythmie (Maze)", bloc:["L√©sions de blocage oreillettes","¬± Clip oreillette gauche","Contr√¥le rythme"], postop:["Rythme/ECG","Anticoag (RP)","Douleur"]},
        {id:'dav', label:"Dispositif d'assistance ventriculaire", ui:"Pompe d‚Äôassistance cardiaque (DAV)", bloc:["Implantation pompe","Connexion apex/aorte","R√©glages"], postop:["Anticoagulation","Soins driveline","√âducation patient"]}
      ]
    },

    // GRANDS BR√õL√âS
    {
      id:'brules', categorie:'Grands br√ªl√©s', titre:'Grands br√ªl√©s',
      bloc:["D√©bridement","Greffes cutan√©es","Pansements"],
      postop:["Kin√©sith√©rapie/orth√®ses","Suivi psycho","Cicatrices"],
      procedures:[
        {id:'debridement', label:'D√©bridement', ui:"Nettoyage des tissus br√ªl√©s (D√©bridement)", bloc:["Toilette chirurgicale","Retrait n√©croses","Pr√©paration greffe"], postop:["Douleur","Infection","Pansements"]},
        {id:'greffe-peau', label:'Greffe de peau', ui:"Recouvrement par greffe (Greffe cutan√©e)", bloc:["Pr√©l√®vement site donneur","Greffe en filet/lambeau","Fixation"], postop:["Prise de greffe","Soins pansements","R√©√©ducation cicatrices"]}
      ]
    },

    // NEUROLOGIE TRAUMATIQUE
    {
      id:'neurotrauma', categorie:'Neurologie traumatique', titre:'Neurologie traumatique (TCC, moelle, nerfs p√©riph.)',
      bloc:["Craniotomie d√©compressive","Fixation rachidienne","R√©paration nerveuse"],
      postop:["R√©√©ducation","Pr√©vention escarres/TVP","Suivi long cours"],
      procedures:[
        {id:'decompression', label:'Craniotomie d√©compressive', ui:"Soulager la pression (Craniotomie d√©compressive)", bloc:["Ouverture cr√¢nienne large","Duretomie si besoin","D√©rivation/monitoring"], postop:["PIC/neuromoniteur","TDM de contr√¥le","Soins REA"]},
        {id:'fix-rachis', label:'Fixation rachidienne', ui:"Stabiliser la colonne (Fixation rachidienne)", bloc:["Vis p√©diculaires/tiges","Greffon/cage si besoin","Contr√¥le stabilit√©"], postop:["D√©ficit moteur/sensoriel","Imagerie","Mobilisation encadr√©e"]},
        {id:'reparation-nerf', label:'R√©paration nerveuse', ui:"R√©parer un nerf (Neurorraphie/Greffe)", bloc:["Rep√©rage extr√©mit√©s","Sutures √©pineurales","Greffe si perte"], postop:["Douleur neuropathique","R√©√©ducation sensitive/motrice","Suivi EMG (RP)"]}
      ]
    }
  ];

  const $ = s=>document.querySelector(s);
  function blobDownload(filename, text){ const blob=new Blob([text],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); URL.revokeObjectURL(a.href); }

  function makeReport(item, selectedProcId){
    const proc = (item.procedures||[]).find(p=>p.id===selectedProcId);
    const bloc = proc ? proc.bloc : item.bloc;
    const postop = proc ? proc.postop : item.postop;
    const titleLine = proc ? `Type d'intervention : ${proc.label}\n\n` : '';
    return `${titleLine}BLOC/OP√âRATION:\n- ${bloc.join('\n- ')}\n\nPOST-OP / SURVEILLANCE:\n- ${postop.join('\n- ')}`;
  }

  const state={ q:'', selectedId:null, selectedProc:{} };

  function filterData(){
    const q=state.q.trim().toLowerCase();
    return bank.filter(it=>{
      const hay=[it.titre,it.categorie,(it.procedures||[]).map(p=>p.label).join(' ')].join(' ').toLowerCase();
      return !q || hay.includes(q);
    });
  }

  function renderResults(){
    const list=$('#results'); list.innerHTML='';
    const data=filterData();
    if(!data.length){ list.innerHTML='<div class="card p-6 text-center">Aucun r√©sultat</div>'; return; }
    data.forEach(item=>{
      const card=document.createElement('div'); card.className='card p-3';
      card.innerHTML=`<div class='text-sm font-semibold'>${item.titre}</div>
        <div class='flex flex-wrap gap-1 mt-1'><span class='badge'>${item.categorie}</span></div>
        <div class='flex gap-2 pt-3'><button class='btn btn-primary'>üßæ Composer</button><button class='btn btn-ghost'>üìã Voir</button></div>`;
      card.querySelector('.btn-primary').onclick=()=>composeReport(item);
      card.querySelector('.btn-ghost').onclick=()=>showDetails(item);
      list.appendChild(card);
    });
  }

  function showDetails(item){
    state.selectedId=item.id;
    const wrap=$('#detailsWrap'); wrap.innerHTML='';
    const card=document.createElement('div'); card.className='card p-4';
    card.innerHTML=`<div class='flex justify-between'>
        <h3 class='text-base font-semibold'>${item.titre}</h3>
        <button class='btn btn-primary' id='btnCompose2'>üßæ Composer</button>
      </div>
      <div class='mt-3'>
        <div class='text-sm font-semibold mb-1'>Type d'intervention</div>
        <div id='procList' class='grid sm:grid-cols-2 gap-2'></div>
      </div>
      <div class='tabs mt-4 flex gap-2'>
        <button data-tab='bloc' class='active'>üõ†Ô∏è Bloc</button>
        <button data-tab='postop'>üíä Post-op</button>
      </div>
      <div id='tabContent' class='mt-3'></div>`;

    const box=card.querySelector('#procList');
    const current=state.selectedProc[item.id]||null;
    (item.procedures||[]).forEach(p=>{
      const id=`proc-${item.id}-${p.id}`;
      const row=document.createElement('label'); row.className='flex items-center gap-2 p-2 rounded border'; row.style.borderColor='var(--border)';
      row.innerHTML=`<input type='radio' name='proc-${item.id}' id='${id}' ${current===p.id?'checked':''}/> <span class='text-sm'>${p.ui||p.label}</span>`;
      row.querySelector('input').addEventListener('change',()=>{ state.selectedProc[item.id]=p.id; renderTab(currentTab()); });
      box.appendChild(row);
    });

    card.querySelector('#btnCompose2').onclick=()=>composeReport(item);

    const tabs=card.querySelectorAll('[data-tab]');
    tabs.forEach(btn=>btn.onclick=()=>{ tabs.forEach(b=>b.classList.remove('active')); btn.classList.add('active'); renderTab(btn.dataset.tab); });
    function currentTab(){ return [...tabs].find(b=>b.classList.contains('active')).dataset.tab; }
    function bullets(a){ return `<ul class='list-dash space-y-1 text-sm'>${a.map(x=>`<li>${x}</li>`).join('')}</ul>`; }
    function renderTab(name){
      const c=card.querySelector('#tabContent');
      const procId=state.selectedProc[item.id];
      const proc=(item.procedures||[]).find(p=>p.id===procId);
      c.innerHTML = name==='bloc' ? bullets(proc?proc.bloc:item.bloc) : bullets(proc?proc.postop:item.postop);
    }
    renderTab('bloc');
    wrap.appendChild(card);
    scrollTo({ top: card.offsetTop - 80, behavior: 'smooth' });
  }

  function composeReport(item){
    const text=makeReport(item, state.selectedProc[item.id]);
    $('#report').value=text;
    localStorage.setItem('gta_rp_chir_report', text);
  }

  // Actions
  $('#q').oninput=e=>{ state.q=e.target.value; renderResults(); };
  $('#btnReset').onclick=()=>{ $('#q').value=''; state.q=''; renderResults(); };
  $('#btnCopy').onclick=()=>navigator.clipboard.writeText($('#report').value||'');
  $('#btnDownload').onclick=()=>{ const t=$('#report').value||''; const name='rapport_chirurgie_RP.txt'; const blob=new Blob([t],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click(); URL.revokeObjectURL(a.href); };

  // Init
  const cached=localStorage.getItem('gta_rp_chir_report'); if(cached) $('#report').value=cached;
  renderResults();
  </script>
</body>
</html>
