<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chirurgie Complexe ‚Äî GTA RP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <style>
    :root {
      --bg: #f8fafc;
      --panel: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --muted: #64748b;
      --chip: #f1f5f9;
      --shadow: 0 8px 24px rgba(2, 6, 23, .06);
      --ring: rgba(15, 23, 42, .12);
      --accent: #0f172a;
    }
    .dark {
      --bg: #0b1220;
      --panel: #0f172a;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --chip: #111827;
      --shadow: 0 8px 24px rgba(0, 0, 0, .35);
      --ring: rgba(148, 163, 184, .2);
      --accent: #38bdf8;
    }
    body { background: var(--bg); color: var(--text); }
    .card { background: var(--panel); border: 1px solid var(--border); border-radius: 1rem; box-shadow: var(--shadow); }
    .btn { display: inline-flex; align-items: center; gap: .5rem; padding: .5rem .75rem; border-radius: .75rem; border: 1px solid var(--border); font-weight: 600; font-size: .9rem; }
    .btn:hover { box-shadow: 0 0 0 6px var(--ring); }
    .btn-primary { background: var(--accent); color: white; border-color: var(--accent); }
    .btn-ghost { background: var(--panel); color: var(--text); }
    .badge { display: inline-flex; align-items: center; padding: .15rem .5rem; border-radius: 9999px; font-size: .75rem; border: 1px solid var(--border); background: var(--chip); color: var(--muted); }
    .tabs button { padding: .4rem .75rem; border-radius: .6rem; font-weight: 600; font-size: .9rem; color: var(--muted); }
    .tabs button.active { background: var(--accent); color: white; }
    .list-dash li { position: relative; padding-left: 1rem; }
    .list-dash li::before { content: "‚Ä¢"; position: absolute; left: 0; color: var(--accent); }
    .sticky-col { position: sticky; top: 6rem; }
    .field { border: 1px solid var(--border); background: var(--panel); color: var(--text); border-radius: .75rem; padding: .6rem .75rem; }
    .menu { border: 1px solid var(--border); background: var(--panel); border-radius: .75rem; box-shadow: var(--shadow); }
  </style>
</head>
<body>
  <header class="sticky top-0 z-30 backdrop-blur border-b" style="background:color-mix(in oklab,var(--panel) 80%, transparent)">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="flex items-center gap-2">
        <span class="text-2xl">ü©∫</span>
        <h1 class="text-lg md:text-xl font-semibold">Chirurgie Complexe ‚Äî Guide RP</h1>
      </div>
      <span class="ml-auto badge">H√¥pital ‚Äî GTA RP</span>
      <button id="themeToggle" class="btn btn-ghost ml-2" title="Mode sombre (t)">üåó <span class="hidden md:inline">Th√®me</span></button>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 grid lg:grid-cols-3 gap-6">
    <section class="lg:col-span-2 space-y-4">
      <div class="card p-4">
        <div class="flex flex-col gap-4">
          <div class="flex flex-wrap gap-2 items-center">
            <div class="relative grow">
              <input id="q" class="field pl-10 w-full" placeholder="Rechercher: fracture, rachis, br√ªlure, valve‚Ä¶" />
              <span class="absolute left-3 top-1/2 -translate-y-1/2 opacity-60">üîé</span>
            </div>
            <button id="btnReset" class="btn btn-ghost">‚Ü∫ R√©initialiser</button>
          </div>
          <div id="results" class="grid md:grid-cols-2 gap-3"></div>
          <div id="detailsWrap"></div>
        </div>
      </div>
    </section>

    <aside class="space-y-4">
      <div class="card p-4 sticky-col">
        <div class="flex items-center gap-2 mb-2">
          <span>üìù</span>
          <h2 class="text-base font-semibold">Rapport m√©dical (g√©n√©rateur)</h2>
        </div>
        <textarea id="report" class="w-full min-h-[380px] field font-mono" placeholder="Clique sur 'Composer rapport' depuis une fiche pour pr√©-remplir ici‚Ä¶"></textarea>
        <div class="flex gap-2 justify-end mt-2">
          <button id="btnCopy" class="btn btn-ghost">üìã Copier</button>
          <button id="btnDownload" class="btn btn-primary">‚¨áÔ∏è T√©l√©charger</button>
        </div>
        <hr class="my-3" style="border-color:var(--border)" />
        <p class="text-sm" style="color:var(--muted)">
          Le rapport g√©n√©r√© contient uniquement : <b>BLOC/OP√âRATION</b> et <b>POST-OP / SURVEILLANCE</b>.
        </p>
      </div>
    </aside>
  </main>

  <footer class="max-w-7xl mx-auto px-4 pb-8 text-xs" style="color:var(--muted)">
    <hr class="mb-3" style="border-color:var(--border)" />
    ‚ö†Ô∏è Outil de jeu ‚Äî GTA RP. Proc√©dures simplifi√©es et non prescriptives. Ce contenu ne constitue pas un conseil m√©dical r√©el.
  </footer>

  <script>
  const root = document.documentElement;
  const THEME_KEY = 'gta_rp_theme';
  function setTheme(mode){
    if(mode==='dark'){ root.classList.add('dark'); localStorage.setItem(THEME_KEY,'dark'); }
    else { root.classList.remove('dark'); localStorage.setItem(THEME_KEY,'light'); }
  }
  (function(){
    const saved = localStorage.getItem(THEME_KEY);
    if(saved) setTheme(saved);
    else if(window.matchMedia('(prefers-color-scheme: dark)').matches) setTheme('dark');
  })();
  document.getElementById('themeToggle').addEventListener('click', ()=>setTheme(root.classList.contains('dark')?'light':'dark'));
  window.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='t') document.getElementById('themeToggle').click(); });

  const CATEGORIES = [
    "Orthop√©die/Os","Cr√¢ne/Neurochir","Rachis","Muscles/Tendons","Thorax","Cardiaque","Visc√©ral/Abdomen","Grands br√ªl√©s","Neurologie traumatique"
  ];

  const bank = [
    { id:'os-fix', titre:'R√©paration osseuse (broches/vis/plaques/p√¢te)', categorie:'Orthop√©die/Os', bloc:["Broches/clous IM: r√©alignement + verrouillage","Plaques + vis anatomiques si fracture articulaire/complexe","P√¢te/greffe osseuse si perte de substance"], postop:["Contr√¥le vasculo-nerveux post-immobilisation","Imagerie de contr√¥le","D√©charge/b√©quilles selon segment"] },
    { id:'crane', titre:'Chirurgie cr√¢nienne (craniotomie / cr√¢nioplastie)', categorie:'Cr√¢ne/Neurochir', bloc:["Craniotomie: volet + √©vacuation h√©matome","Plaques/vis titane pour refixation","Cr√¢nioplastie ou ciment (PMMA/hydroxyapatite) si d√©faut"], postop:["Surveillance neuro rapproch√©e","Scan de contr√¥le","Pr√©vention infection"] },
    { id:'rachis', titre:'Rachis (discectomie, laminectomie, fusion, foraminotomie)', categorie:'Rachis', bloc:["Discectomie si conflit disque-nerf","Laminectomie pour d√©compression","Fusion + vis/tiges, cage si instabilit√©"], postop:["Surveillance neuro","Mobilisation encadr√©e","Imagerie de contr√¥le"] },
    { id:'muscle', titre:'Rupture musculaire (partielle/compl√®te)', categorie:'Muscles/Tendons', bloc:["Suture des berges musculaires","Renfort tendineux si besoin"], postop:["Immobilisation initiale","Mobilisation douce","Renforcement progressif"] },
    { id:'thorax', titre:'Chirurgie thoracique (lobe, m√©diastin, trach√©e, trauma)', categorie:'Thorax', bloc:["Lobectomie/segmentectomie selon l√©sion","D√©cortication pleurale","Trach√©otomie si voie a√©rienne compromise"], postop:["Surveillance respi + drains","Kin√© respi","Contr√¥le fuites d'air"] },
    { id:'cardiaque', titre:'Cardiaque (pontage, valves, FA, DAV)', categorie:'Cardiaque', bloc:["Pontage coronarien","R√©paration/remplacement valvulaire","Ablation/MAZE","Implant DAV"], postop:["Surveillance en USIC/REA","Pr√©vention infection","R√©√©ducation cardiaque"] },
    { id:'visc', titre:'Visc√©ral/Abdomen (appendice, v√©sicule, hernie, r√©section‚Ä¶)', categorie:'Visc√©ral/Abdomen', bloc:["Appendicectomie (souvent coelio)","Chol√©cystectomie coelio","Herniorraphie/mesh","R√©section intestinale ¬± stomie","Gastrectomie / sleeve","H√©patectomie partielle","Pancr√©atectomie","Spl√©nectomie"], postop:["Surveillance souillures/saignement","Reprise du transit","Douleur"] },
    { id:'brules', titre:'Grands br√ªl√©s', categorie:'Grands br√ªl√©s', bloc:["D√©bridement","Greffes cutan√©es","Pansements sp√©cifiques"], postop:["Kin√© + orth√®ses","Suivi psycho","Gestion cicatrices"] },
    { id:'neurotrauma', titre:'Neurologie traumatique (TCC, moelle, nerfs p√©riph.)', categorie:'Neurologie traumatique', bloc:["Craniotomie d√©compressive","Fixation rachidienne","R√©paration nerveuse"], postop:["R√©√©ducation pluridisciplinaire","Pr√©vention escarres/TVP","Suivi long cours"] }
  ];

  const $ = sel => document.querySelector(sel);
  function blobDownload(filename, text){ const blob = new Blob([text], {type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); URL.revokeObjectURL(a.href); }

  function makeReport(item){
    return `BLOC/OP√âRATION:\n- ${item.bloc.join('\n- ')}\n\nPOST-OP / SURVEILLANCE:\n- ${item.postop.join('\n- ')}`;
  }

  const state = { q:'', selectedId:null };
  function filterData(){ const q=state.q.trim().toLowerCase(); return bank.filter(it=>!q || it.titre.toLowerCase().includes(q)); }

  function renderResults(){
    const list=$('#results'); list.innerHTML='';
    const data=filterData();
    if(!data.length){ list.innerHTML='<div class=\"card p-6 text-center\">Aucun r√©sultat trouv√©</div>'; return; }
    data.forEach(item=>{
      const card=document.createElement('div'); card.className='card p-3';
      card.innerHTML=`<div class='text-sm font-semibold'>${item.titre}</div><div class='flex flex-wrap gap-1 mt-1'><span class='badge'>${item.categorie}</span></div><div class='flex gap-2 pt-3'><button class='btn btn-primary'>üßæ Composer</button><button class='btn btn-ghost'>üìã Voir</button></div>`;
      card.querySelector('.btn-primary').onclick=()=>composeReport(item);
      card.querySelector('.btn-ghost').onclick=()=>showDetails(item);
      list.appendChild(card);
    });
  }

  function showDetails(item){
    const wrap=$('#detailsWrap'); wrap.innerHTML='';
    const card=document.createElement('div'); card.className='card p-4';
    card.innerHTML=`<h3 class='text-base font-semibold mb-2'>${item.titre}</h3><div class='tabs flex flex-wrap gap-2'><button data-tab='bloc' class='active'>üõ†Ô∏è Bloc</button><button data-tab='postop'>üíä Post-op</button></div><div id='tabContent' class='mt-3'></div>`;
    const tabs=card.querySelectorAll('[data-tab]');
    tabs.forEach(btn=>btn.onclick=()=>{tabs.forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderTab(btn.dataset.tab);});
    function bullets(arr){return `<ul class='list-dash space-y-1 text-sm'>${arr.map(x=>`<li>${x}</li>`).join('')}</ul>`;}
    function renderTab(name){const c=card.querySelector('#tabContent'); if(name==='bloc') c.innerHTML=bullets(item.bloc); else c.innerHTML=bullets(item.postop);}
    renderTab('bloc'); wrap.appendChild(card);
  }

  function composeReport(item){
    const text=makeReport(item);
    $('#report').value=text;
    localStorage.setItem('gta_rp_chir_report',text);
  }

  $('#q').oninput=e=>{state.q=e.target.value;renderResults();};
  $('#btnReset').onclick=()=>{$('#q').value='';state.q='';renderResults();};
  $('#btnCopy').onclick=()=>navigator.clipboard.writeText($('#report').value||'');
  $('#btnDownload').onclick=()=>blobDownload('rapport_chirurgie_RP.txt',$('#report').value||'');

  const cached=localStorage.getItem('gta_rp_chir_report');
  if(cached) $('#report').value=cached;

  renderResults();
  </script>
</body>
</html>
